





--Bảng JobApiTestSuite — mô tả 1 API cần test

| Cột           | Kiểu dữ liệu  | Mô tả                                                    |
| ------------- | ------------- | -------------------------------------------------------- |
| `id`          | INT, PK, AI   | ID tự tăng                                               |
| `name`        | NVARCHAR(200) | Tên mô tả (vd: "Khuyến mãi")                             |
| `endpoint`    | NVARCHAR(500) | Đường dẫn API (`api/KhuyenMai`)                          |
| `method`      | NVARCHAR(10)  | GET / POST / PUT / DELETE                                |
| `headers`     | NVARCHAR(MAX) | JSON header (ví dụ: `{ "Authorization": "Bearer ..." }`) |
| `dataBase`    | NVARCHAR(MAX) | JSON dữ liệu mặc định test                               |
| `description` | NVARCHAR(500) | Mô tả mục đích                                           |
| `isActive`    | BIT           | Bật/tắt test này                                         |
| `createdAt`   | DATETIME      | Ngày tạo                                                 |
| `createdBy`   | NVARCHAR(100) | Người tạo                                                |
| `updatedAt`   | DATETIME      | Cập nhật lần cuối                                        |
| `updatedBy`   | NVARCHAR(100) | Người cập nhật                                           |

| id | name            | endpoint      | method | headers                                                          | dataBase |
| -- | --------------- | ------------- | ------ | ---------------------------------------------------------------- | -------- |
| 1  | Test Khuyến Mãi | api/KhuyenMai | POST   | {"Content-Type":"application/json","Authorization":"Bearer ..."} | {...}    |



--Bảng JobApiTestCase — các test case con của 1 API

| Cột                | Kiểu dữ liệu              | Mô tả                                                      |
| ------------------ | ------------------------- | ---------------------------------------------------------- |
| `id`               | INT, PK, AI               | ID test case                                               |
| `apiTestSuiteId`   | INT, FK → ApiTestSuite.id | Liên kết đến API cha                                       |
| `caseName`         | NVARCHAR(200)             | Tên test case (vd: “Thiếu tên khuyến mãi”)                 |
| `testData`         | NVARCHAR(MAX)             | JSON ghi đè (vd: `{ "master": { "tenKhuyenMai": null } }`) |
| `expectedStatus`   | INT                       | Mã HTTP mong đợi (vd: 200 / 400)                           |


| id | apiTestSuiteId | caseName             | testData                             | expectedStatus |
| -- | -------------- | -------------------- | ------------------------------------ | -------------- |
| 1  | 1              | Thiếu tên khuyến mãi | {"master":{"tenKhuyenMai":null}}     | 400            |
| 2  | 1              | Đủ dữ liệu           | {}                                   | 200            |
| 3  | 1              | Đổi tên              | {"master":{"tenKhuyenMai":"Test 3"}} | 200            |




--Bảng JobApiTestHistory — lưu lịch sử chạy job

| Cột              | Kiểu dữ liệu             | Mô tả                   |
| ---------------- | ------------------------ | ----------------------- |
| `id`             | INT, PK, AI              |                         |
| `apiTestCaseId`  | INT, FK → ApiTestCase.id |                         |
| `runAt`          | DATETIME                 | Thời điểm chạy          |
| `requestPayload` | NVARCHAR(MAX)            | Dữ liệu gửi đi thực tế  |
| `responseData`   | NVARCHAR(MAX)            | Kết quả trả về          |
| `statusCode`     | INT                      | Mã trả về               |
| `isSuccess`      | BIT                      | Có pass không           |
| `durationMs`     | INT                      | Thời gian phản hồi (ms) |
| `errorMessage`   | NVARCHAR(1000)           | Lỗi nếu có              |


 
--Bảng JobScheduleApiTest — lịch chạy tự động cho API test
| Cột                       | Kiểu dữ liệu  | Mô tả                                                     |
| ------------------------- | ------------- | --------------------------------------------------------- |
| **Id**                    | INT           | Khóa chính (tự tăng)                                      |
| **UserId**                | INT           | Id tài khoản tạo                                          |
| **Name**                  | NVARCHAR(200) | Tên job (ví dụ: “Daily Morning Test”)                     |
| **Description**           | NVARCHAR(500) | Ghi chú mô tả job                                         |
| **ScheduleType**          | NVARCHAR(50)  | Kiểu lịch chạy (`daily` hoặc `interval`)                  |
| **RunAtTime**             | TIME          | Giờ chạy cố định nếu `ScheduleType = 'daily'`             |
| **IntervalMinutes**       | INT           | Số phút giữa các lần chạy nếu `ScheduleType = 'interval'` |
| **IsActive**              | BIT           | Bật/tắt job (1 = bật, 0 = tắt)                            |
| **CreatedAt / UpdatedAt** | DATETIME      | Ngày tạo / cập nhật                                       |



| Giá trị      | Ý nghĩa                       | Cách dùng                                            |
| ------------ | ----------------------------- | ---------------------------------------------------- |
| `'daily'`    | Chạy mỗi ngày vào giờ cố định | Dùng `RunAtTime` (vd: `02:00:00` → 2h sáng mỗi ngày) |
| `'interval'` | Chạy lặp lại sau mỗi X phút   | Dùng `IntervalMinutes` (vd: `30` → mỗi 30 phút)      |


| Id |UserId| Name                | ScheduleType | RunAtTime | IntervalMinutes | IsActive |
| -- |------| ------------------- | ------------ | --------- | --------------- | -------- |
| 1  |1     | Daily 2AM Test      | daily        | 02:00:00  | NULL            | 1        |
| 2  |1     |Interval 30min Test  | interval     | NULL      | 30              | 1        |












 
